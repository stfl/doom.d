#+title: doom-emacs config
#+startup: content

* User Information
:PROPERTIES:
:ID:       47537e03-28e5-4adf-ac0b-ab8249ce01bf
:END:
Some functionality uses this to identify you, e.g. GPG configuration, email
clients, file templates and snippets.


#+BEGIN_SRC elisp
(setq user-full-name "Stefan Lendl"
      user-mail-address "ste.lendl@gmail.com")
#+END_SRC

#+BEGIN_SRC elisp
(setq auth-sources '("~/.config/authinfo/authinfo.gpg")
       ;; auth-source-cache-expiry nil ; default is 7200 (2h)
      )
;; (require 'auth-source)
;; (auth-source-forget-all-cached)  ;; forget all cached entries to force loading entries at start
#+END_SRC

function to load a secret from an auth-source. [[https://gist.github.com/letoh/5497116][letoh/creation-prompt.el]]
#+BEGIN_SRC elisp
(defun get-auth-info (host user &optional port)
  (let ((info (nth 0 (auth-source-search
                      :host host
                      :user user
                      :port port
                      :require '(:user :secret)))))
    (if info
        (let ((secret (plist-get info :secret)))
          (if (functionp secret)
              (funcall secret)
            secret))
      nil)))
#+END_SRC

* Terminal Mode
:PROPERTIES:
:ID:       2ecfb384-6c47-45c9-b7ea-2eb3c9b25311
:END:

Set a few settings if we detect terminal mode
#+BEGIN_SRC elisp
(when (equal (window-system) nil)
  (and
   (bind-key "C-<down>" #'+org/insert-item-below)
   (setq doom-theme 'doom-solarized-dark)
   (setq doom-font (font-spec :family "Source Code Pro" :size 20))))
#+END_SRC

* UI
:PROPERTIES:
:ID:       00776006-97ad-487f-a34e-510b7df5d5a3
:END:
start maximized

#+begin_src elisp
(toggle-frame-maximized)
#+end_src

** Font
:PROPERTIES:
:ID:       edf590c3-3d81-45b2-a180-fb46609bc099
:END:
Doom exposes five (optional) variables for controlling fonts in Doom. Here
are the three important ones:

+ `doom-font'
+ `doom-variable-pitch-font'
+ `doom-big-font' -- used for `doom-big-font-mode'; use this for
  presentations or streaming.

They all accept either a font-spec, font string ("Input Mono-12"), or xlfd
font string. You generally only need these two:

#+BEGIN_SRC elisp
;; (setq doom-font (font-spec :family "Fira Code" :size 13)
;;       doom-variable-pitch-font (font-spec :family "Fira Code")
;;       doom-unicode-font (font-spec :family "DejaVu Sans Mono")
;;       doom-big-font (font-spec :family "Fira Code Medium" :size 20))
(setq doom-font (font-spec :family "JetBrains Mono" :size 13)
      doom-variable-pitch-font (font-spec :family "JetBrains Mono")
      doom-unicode-font (font-spec :family "DejaVu Sans Mono")
      doom-big-font (font-spec :family "JetBrains Mono" :size 20))
#+END_SRC

#+BEGIN_SRC elisp
;; (setq doom-theme 'zaiste)
(setq doom-theme 'doom-one)
;; (setq doom-theme 'doom-one-light)
;; (setq doom-theme 'doom-molokai)
;; (setq doom-theme 'doom-solarized-dark)

;; (setq doom-themes-enable-bold t    ; if nil, bold is universally disabled
;;       doom-themes-enable-italic t) ; if nil, italics is universally disabled
#+END_SRC

#+BEGIN_SRC elisp
;; (use-package! fira-code-mode
;;   :after prog-mode
;;   :custom (fira-code-mode-disabled-ligatures '("[]" "#{" "#(" "#_" "#_(" "x" "*" "+" ":")) ;; List of ligatures to turn off
;;   )
#+END_SRC

#+BEGIN_SRC elisp
(setq! display-line-numbers-type t)
(setq! which-key-idle-delay 0.3)
#+END_SRC

** Faces
:PROPERTIES:
:ID:       a0baba11-f7c0-484f-b9e3-e75957447031
:END:

#+begin_src elisp
(custom-set-faces!
 '(org-date :foreground "dark goldenrod" :height 0.85)
 '(org-document-title :foreground "#c678dd" :weight bold :height 1.8)
 '(org-drawer :foreground "dark gray" :height 0.8)
 '(outline-1 :height 1.5)
 '(outline-2 :height 1.25)
 '(outline-3 :height 1.15)
 '(org-property-value :height 0.85)
 '(org-special-keyword :foreground "#83898d" :height 0.8)
 '(org-tag :foreground "#83898d" :weight light :height 0.7)
 '(org-ql-view-due-date :foreground "dark goldenrod")
 )
#+end_src

#+begin_src elisp
;; (custom-set-faces!
;;  ;; custom-set-faces was added by Custom.
;;  ;; If you edit it byrhand, you could mess it up, so be careful.
;;  ;; Your init file should contain only one such instance.
;;  ;; If there is more than one, they won't work right.
;;  '(org-date ((t (:foreground "dark goldenrod" :height 0.85))))
;;  '(org-document-title ((t (:foreground "#c678dd" :weight bold :height 1.8))))
;;  '(org-drawer ((t (:foreground "dark gray" :height 0.8))))
;;  '(org-level-1 ((t (:inherit outline-1 :extend t :height 1.5))))
;;  '(org-level-2 ((t (:inherit outline-2 :extend t :height 1.25))))
;;  '(org-level-3 ((t (:inherit outline-3 :extend t :height 1.15))))
;;  '(org-level-4 ((t (:inherit outline-4 :extend t :height 1.0))))
;;  '(org-level-5 ((t (:inherit outline-5 :extend t))))
;;  '(org-level-6 ((t (:inherit outline-6 :extend t))))
;;  '(org-level-7 ((t (:inherit outline-7 :extend t))))
;;  '(org-level-8 ((t (:inherit outline-8 :extend t))))
;;  '(org-property-value ((t (:height 0.85))) t)
;;  '(org-special-keyword ((t (:foreground "#83898d" :height 0.8))))
;;  '(org-tag ((t (:foreground "#83898d" :weight light :height 0.7))))
;;  )
 ;; '(fixed-pitch ((t (:font #<font-spec nil nil JetBrains\ Mono nil nil nil nil nil 13 nil nil nil nil>))))
 ;; '(variable-pitch ((t (:font #<font-spec nil nil JetBrains\ Mono nil nil nil nil nil nil nil nil nil nil>))))
#+end_src
** popup rules
:PROPERTIES:
:ID:       1f322103-dc44-4293-b354-a8f5301b89e4
:END:
#+BEGIN_SRC elisp
(set-popup-rule! "^CAPTURE" :side 'bottom :size 0.40 :select t :ttl nil)

(after! org-ql
  (set-popup-rule!
    "^\\*Org QL View" :side 'left :size 0.40 :select t :quit nil
    ))
#+END_SRC

;; This determines the style of line numbers in effect. If set to `nil', line
;; numbers are disabled. For relative line numbers, set this to `relative'.

* Motions
:PROPERTIES:
:ID:       1ff57529-42f3-4cb9-b974-70c0f0315b36
:END:
limit evil-snipe to the bufffer
#+BEGIN_SRC elisp
(after! evil-snipe
  (setq evil-snipe-scope 'whole-visible)
  (setq evil-snipe-repeat-scope nil)  ;; same as evil-snipe-scope
  )
#+END_SRC

* Buffer Settings
:PROPERTIES:
:ID:       508b2ffc-2dfd-49e1-b44e-af2994a59df0
:END:
#+BEGIN_SRC elisp
;; (global-auto-revert-mode 1)
(setq undo-limit 80000000
      evil-want-fine-undo t
      auto-save-default t
      inhibit-compacting-font-caches t)
#+END_SRC

* Org mode settings
:PROPERTIES:
:ID:       21db6be7-63e5-4034-b766-f5221efdd0ca
:END:
** General
:PROPERTIES:
:ID:       90a92aaa-d50a-4524-9a97-bad904b60939
:END:
Org directory

#+BEGIN_SRC elisp
(setq org-directory "~/.org/")
#+END_SRC

First I like to add some extra fancy stuff to make orgmode more appealing when i'm using =+pretty= flag.
#+BEGIN_SRC elisp
(after! org
  (setq org-hide-emphasis-markers t
        org-hide-leading-stars t
        org-list-demote-modify-bullet '(("+" . "-") ("1." . "a.") ("-" . "+"))
        org-ellipsis " ▼"
        ))
#+END_SRC

- Other options for ellipsis "▼, ↴, ⬎, ⤷,…, and ⋱."
- Extra options for headline-bullets-list: "◉" "●" "○" "∴"

# Add a when condition that only adjust settings when certain features are enabled... This depends on where i'm running Emacs from (eg: Terminla, X11 or native).
# #+BEGIN_SRC elisp
# (when (require 'org-superstar nil 'noerror)
#   (setq org-superstar-headline-bullets-list '("◉" "●" "○")
#         org-superstar-item-bullet-alist nil))
# #+END_SRC

always generate an id for a link

#+BEGIN_SRC elisp
(use-package org-id
  :after org
  :config
  (setq org-id-link-to-org-use-id t
        org-id-locations-file "~/.emacs.d/.local/.org-id-locations"
        org-id-track-globally t))
#+END_SRC

rebuild orgid file on start

#+begin_src elisp
(after! org
  ;; (async-start
   (org-id-update-id-locations)
   ;; 'ignore)
   )
#+end_src

** Auto-saving org-mode files
:PROPERTIES:
:ID:       d206a353-12c6-4d53-9f6f-97e24840c79e
:END:

Automatically saving all org-buffers

#+BEGIN_SRC elisp
(after! org
  (add-hook 'auto-save-hook 'org-save-all-org-buffers 10)
  ;; (add-hook 'auto-save-hook 'org-id-update-id-locations 20)
  )

;; (after! org-roam
;;   (add-hook 'auto-save-hook 'org-roam-build-cache 40))
#+END_SRC

** Orgmode Startup
:PROPERTIES:
:ID:       fadd0d57-a6dd-4d17-ab0c-784b5159b7ed
:END:
#+BEGIN_SRC elisp
(after! org
  (setq org-startup-indented 'indent
         org-startup-folded 'fold
         org-startup-with-inline-images t
         )
)
(add-hook 'org-mode-hook 'org-indent-mode)
;; (add-hook 'org-mode-hook 'turn-off-auto-fill)
#+END_SRC

See https://github.com/hlissner/doom-emacs/issues/3185 - Invalid base64 data
#+BEGIN_SRC elisp
(defadvice! no-errors/+org-inline-image-data-fn (_protocol link _description)
  :override #'+org-inline-image-data-fn
  "Interpret LINK as base64-encoded image data. Ignore all errors."
  (ignore-errors
    (base64-decode-string link)))
#+END_SRC

** Key Bindings
:PROPERTIES:
:ID:       f98aed8d-22e1-401a-940a-09193f2ba5ef
:END:
From here we load some extra key bindings that I use often
#+BEGIN_SRC elisp
;; (bind-key "<f6>" #'link-hint-copy-link)
(map! :after org
      :map org-mode-map
      :leader
      :prefix ("n" . "notes")
      :desc "Revert all org buffers" "R" #'org-revert-all-org-buffers
      :desc "Revert all org buffers" "R" #'org-revert-all-org-buffers
      )

;; Die sind eigentlich nicht org spezifisch
      ;; :desc "Outline" "o" #'counsel-outline
      ;; :desc "Counsel ripgrep" "d" #'counsel-rg
      ;; :desc "Swiper All" "@" #'swiper-all

(map! :after org
      :map org-mode-map
      :localleader
      :desc "Revert all org buffers" "R" #'org-revert-all-org-buffers

      :prefix ("s" . "Tree/Subtree")
      ;; :desc "Rifle Org Directory" "/" #'helm-org-rifle-org-directory
      ;; :desc "Rifle Buffer" "B" #'helm-org-rifle-current-buffer
      ;; :desc "Rifle Agenda Files" "A" #'helm-org-rifle-agenda-files
      ;; :desc "Rifle Project Files" "#" #'helm-org-rifle-project-files
      ;; :desc "Rifle Other Project(s)" "$" #'helm-org-rifle-other-files
      :desc "Match sparse tree" "M" #'org-match-sparse-tree

      :prefix ("l" . "links")
      "o" #'org-open-at-point
      "g" #'eos/org-add-ids-to-headlines-in-file

      :prefix ("r" . "refile")
      :desc "Refile to reference" "R" #'stfl/refile-to-roam
      :desc "create org-roam note from headline" "h" #'org-roam-create-note-from-headline
      )

(map! :after org-agenda
      :map org-agenda-mode-map
      :localleader
      :desc "Filter" "f" #'org-agenda-filter
      :desc "Follow" "F" #'org-agenda-follow-mode
      ;; :desc "Priority" "p" #'org-agenda-priority
      ;; :prefix ("s" . "search and set")
      :prefix ("p" . "priorities")
      :desc "Prioity" "p" #'org-agenda-priority
      :desc "Prioity up" "u" #'org-agenda-priority-up
      :desc "Prioity down" "d" #'org-agenda-priority-down
      :desc "Prioity tree" "P" #'org-agenda-priority-tree
      :desc "Prioity tree up" "U" #'org-agenda-priority-tree-up
      :desc "Prioity tree down" "D" #'org-agenda-priority-tree-down
      )

(map! ;;:after org-agenda
      :map org-agenda-mode-map
      :desc "Prioity up" "C-S-k" #'org-agenda-priority-up
      :desc "Prioity down" "C-S-j" #'org-agenda-priority-down
      )
#+END_SRC

Adding additional search functions
#+BEGIN_SRC elisp
;; (defun zyro/rifle-roam ()
;;   "Rifle through your ROAM directory"
;;   (interactive)
;;   (helm-org-rifle-directories org-roam-directory))

;; (map! :after org
;;       :map org-mode-map
;;       :leader
;;       :prefix ("n" . "notes")
;;       :desc "Rifle ROAM Notes" "!" #'zyro/rifle-roam)
#+END_SRC

** Priorities
:PROPERTIES:
:ID:       f5c0a2a6-070e-480e-8c72-888da9416f25
:END:
Set default Priority to C

#+begin_src elisp
(after! org
  (setq org-priority-default ?D)
  (setq org-priority-lowest ?E)
  )
#+end_src
** Agenda
:PROPERTIES:
:ID:       b426d554-e01c-4792-8dfa-e0db617c4384
:END:
#+begin_src elisp
(setq org-agenda-custom-commands
      '(
        ("b" "Agenda and tasks B+"
         ((agenda "Agenda"
                  ((org-agenda-use-time-grid t)
                   (org-deadline-warning-days 1)
                   (org-agenda-span '1)
                   (org-agenda-start-day (org-today))))
          (org-ql-block '(and (todo "NEXT")
                              (or (and (tags "org_jira")        ; for org-jira I need to also check the assignee
                                       (property "assignee" "Stefan Lendl"))
                                  (and (not (tags "org_jira"))  ; otherwise I consider the regular org priority
                                       (or (priority >= "C")
                                           (ancestors (priority >= "C"))
                                           (deadline auto)
                                           (ancestors (deadline auto)))))
                              (not (tags "SOMEDAY"))
                              (not (scheduled))
                              (not (habit)))
                        ((org-ql-block-header "Next Actions")
                         (org-super-agenda-header-separator "")
                         (org-deadline-warning-days 7)
                         (org-super-agenda-groups stfl/priority-groups)
                         ))
          (org-ql-block '(and (todo "PROJ")
                              (priority >= "B")
                              (not (tags "SOMEDAY"))
                              (not (children (and (todo "NEXT" "WAIT")
                                                  (not (tags "SOMEDAY"))))))
                        ((org-ql-block-header "Stuck Projects")
                         (org-super-agenda-header-separator "")
                         (org-super-agenda-groups stfl/priority-groups)
                         ))
          (org-ql-block '(and (todo "WAIT")
                              (or (priority >= "B")
                                  (ancestors (priority >= "B"))
                                  (deadline auto)
                                  (ancestors (deadline auto)))
                              (not (tags "SOMEDAY"))
                              (not (scheduled)))
                        ((org-ql-block-header "Waiting")
                         (org-super-agenda-header-separator "")
                         (org-deadline-warning-days 7)
                         (org-super-agenda-groups stfl/priority-groups)
                         ))
                        ))
        ("c" "Agenda and tasks C+"
         ((agenda "Agenda"
                  ((org-agenda-use-time-grid t)
                   (org-deadline-warning-days 1)
                   (org-agenda-span '1)
                   (org-agenda-start-day (org-today))))
          (org-ql-block '(and (todo "NEXT")
                              (or (and (tags "org_jira")        ; for org-jira I need to also check the assignee
                                       (property "assignee" "Stefan Lendl"))
                                  (and (not (tags "org_jira"))  ; otherwise I consider the regular org priority
                                       (or (priority >= "C")
                                           (ancestors (priority >= "C"))
                                           (deadline auto)
                                           (ancestors (deadline auto)))))
                              (not (tags "SOMEDAY"))
                              (not (scheduled))
                              (not (habit)))
                        ((org-ql-block-header "Next Actions")
                         (org-super-agenda-header-separator "")
                         (org-deadline-warning-days 14)
                         (org-super-agenda-groups stfl/priority-groups)
                         ))
          (org-ql-block '(and (todo "PROJ")
                              (priority >= "C")
                              (not (tags "SOMEDAY"))
                              (not (children (and (todo "NEXT" "WAIT")
                                                  (not (tags "SOMEDAY"))))))
                        ((org-ql-block-header "Stuck Projects")
                         (org-super-agenda-header-separator "")
                         (org-super-agenda-groups stfl/priority-groups)
                         ))
          (org-ql-block '(and (todo "WAIT")
                              (or (priority >= "C")
                                  (ancestors (priority >= "C"))
                                  (deadline auto)
                                  (ancestors (deadline auto)))
                              (not (tags "SOMEDAY"))
                              (not (scheduled)))
                        ((org-ql-block-header "Waiting")
                         (org-super-agenda-header-separator "")
                         (org-deadline-warning-days 14)
                         (org-super-agenda-groups stfl/priority-groups)
                         ))
                        ))
("d" "Agenda and tasks D+"
         ((agenda "Agenda"
                  ((org-agenda-use-time-grid t)
                   (org-deadline-warning-days 1)
                   (org-agenda-span '1)
                   (org-agenda-start-day (org-today))))
          (org-ql-block '(and (todo "NEXT")
                              (or (and (tags "org_jira")        ; for org-jira I need to also check the assignee
                                       (property "assignee" "Stefan Lendl"))
                                  (and (not (tags "org_jira"))  ; otherwise I consider the regular org priority
                                       (or (priority >= "C")
                                           (ancestors (priority >= "C"))
                                           (deadline auto)
                                           (ancestors (deadline auto)))))
                               (not (tags "SOMEDAY"))
                              (not (scheduled))
                              (not (habit)))
                        ((org-ql-block-header "Next Actions")
                         (org-super-agenda-header-separator "")
                         (org-deadline-warning-days 14)
                         (org-super-agenda-groups stfl/priority-groups)
                         ))
          (org-ql-block '(and (todo "PROJ")
                              (priority >= "D")
                              (not (tags "SOMEDAY"))
                              (not (children (and (todo "NEXT" "WAIT")
                                                  (not (tags "SOMEDAY"))))))
                        ((org-ql-block-header "Stuck Projects")
                         (org-super-agenda-header-separator "")
                         (org-super-agenda-groups stfl/priority-groups)
                         ))
          (org-ql-block '(and (todo "WAIT")
                              (or (priority >= "D")
                                  (ancestors (priority >= "D"))
                                  (deadline auto)
                                  (ancestors (deadline auto)))
                              (not (tags "SOMEDAY"))
                              (not (scheduled)))
                        ((org-ql-block-header "Waiting")
                         (org-super-agenda-header-separator "")
                         (org-deadline-warning-days 14)
                         (org-super-agenda-groups stfl/priority-groups)
                         ))
                        ))
        ;; ("t" "Tasks"
        ;;  ((org-ql-block '(and (todo)
        ;;                       (not (tags "SOMEDAY"))
        ;;                       (not (and (todo "TODO")
        ;;                                 (ancestors (todo "PROJ"))))
        ;;                       (not (scheduled))
        ;;                       (not (deadline)))
        ;;                 ((org-super-agenda-groups stfl/org-super-agenda-groups)
        ;;                  (org-ql-block-header "Tasks"))
        ;;                 )))
        ("a" "Agenda Weekly"
         ((agenda ""
                  ((org-agenda-span 'week)
                   (org-agenda-start-on-weekday 1)))))
        ("r" . "Weekly Review")
        ("rc" "Close the last week and finish done tasks"
         ((org-ql-block '(and (todo "NEXT")
                              (not (tags "SOMEDAY" "HABIT"))

                              (not (and (tags "org_jira")
                                        (not (property "assignee" "Stefan Lendl"))))
                              (not (scheduled))
                              ;; (not (ts-active :from ;;"2021-08-01"))  ;; FIXME no idea how to make this work
                              ;;                 (ts-format (ts-adjust 'day 30 (ts-now)))))
                              (not (habit))
                              (or (not (deadline))
                                  (deadline auto)
                                  (ancestors (deadline auto))))
                        ((org-ql-block-header "Next Actions")
                         (org-super-agenda-header-separator "")
                         (org-deadline-warning-days 30)
                         (org-super-agenda-groups stfl/priority-groups)
                         ))
          (org-ql-block '(and (todo "WAIT")
                              (not (tags "SOMEDAY"))
                              (not (scheduled))
                              (or (not (deadline))
                                  (deadline auto)
                                  (ancestors (deadline auto))))
                        ((org-ql-block-header "Waiting")
                         (org-super-agenda-header-separator "")
                         (org-deadline-warning-days 30)
                         (org-super-agenda-groups stfl/priority-groups)
                         ))
          (org-ql-block '(and (todo "PROJ")
                              (not (tags "SOMEDAY"))
                              (not (children (and (todo "NEXT" "WAIT")
                                                  (not (tags "SOMEDAY"))))))
                        ((org-ql-block-header "Stuck Projects")
                         (org-super-agenda-header-separator "")
                         (org-deadline-warning-days 30)
                         (org-super-agenda-groups stfl/priority-groups)
                         ))
                        ))
        ("rl" "Agenda Weekly with Log"
         ;; TODO add archive!
         ((agenda ""
                  ((org-agenda-span 'week)
                   (org-agenda-start-on-weekday 1)
                   (org-agenda-archives-mode t)
                   (org-agenda-start-with-log-mode '(closed))
                   (org-agenda-show-log t)
                   (org-agenda-skip-function '(org-agenda-skip-entry-if 'notregexp "^.*DONE "))
                   ))))
        ("rp" "Plan Projects"
         ((org-ql-block '(and (todo "PROJ")
                              (not (tags "SOMEDAY"))
                              ;; (not (children "SOMEDAY")))
                              (not (children (and (todo "NEXT" "WAIT")
                                                  (tags "SOMEDAY"))))
                              (or (not (deadline))
                                  (deadline auto)
                                  (ancestors (deadline auto))))
                        ((org-ql-block-header "Projects")
                         (org-super-agenda-header-separator "")
                         (org-deadline-warning-days 45)
                         (org-super-agenda-groups stfl/priority-groups)
                         ))
          ))
        ("rn" "Plan Next Actions"
         ((org-ql-block '(and (todo "NEXT")
                              (not (tags "SOMEDAY"))
                              (not (scheduled))
                              (not (habit))
                              (or (not (deadline))
                                  (deadline auto)
                                  (ancestors (deadline auto))))
                        ((org-ql-block-header "Next Actions")
                         (org-super-agenda-header-separator "")
                         (org-deadline-warning-days 14)
                         (org-super-agenda-groups stfl/priority-groups)
                         ))
                        ))
        ("rs" "Stuck Projects"
         ((org-ql-block '(and (todo "PROJ")
                              (not (tags "SOMEDAY"))
                              (not (children (and (todo "NEXT" "WAIT")
                                                  (not (tags "SOMEDAY"))))))
                        ((org-ql-block-header "Stuck Projects")
                         (org-super-agenda-header-separator "")
                         (org-super-agenda-groups stfl/priority-groups)
                         ))
            ))
        ("rS" "SOMEDAY"
         ((org-ql-block '(and (todo "PROJ")
                              (or (and (priority <= "D")
                                       (not (ancestors (priority > "D")))
                                       (not (children (priority > "D"))))
                                  (tags "SOMEDAY")
                                  (children (and (todo "NEXT" "WAIT")
                                                 (tags "SOMEDAY")))
                                  )
                              (not (scheduled))
                              (not (habit))
                              (not (deadline)))
                        ((org-ql-block-header "Projects")
                         (org-super-agenda-header-separator "")
                         (org-super-agenda-groups '((:tag "SOMEDAY" :order 10)
                                                    (:auto-priority)
                                                    ))))
         (org-ql-block '(and (todo "NEXT")
                              (or (and (priority <= "D")
                                  (not (ancestors (priority > "D"))))
                                  (tags "SOMEDAY"))
                              (not (scheduled))
                              (not (habit))
                              (not (deadline)))
                        ((org-ql-block-header "Next Actions")
                         (org-super-agenda-header-separator "")
                         (org-super-agenda-groups '((:tag "SOMEDAY" :order 10)
                                                    (:auto-priority)
                                                    ))))
          ;; (org-ql-block '(and (todo "PROJ")
          ;;                     (not (tags "SOMEDAY"))
          ;;                     (not (children (and (todo "NEXT" "WAIT")
          ;;                                         (not (tags "SOMEDAY"))))))
          ;;               ((org-ql-block-header "Stuck Projects")
          ;;                (org-super-agenda-header-separator "")
          ;;                (org-super-agenda-groups '((:auto-priority)))))
          ;; (org-ql-block '(and (todo "WAIT")
          ;;                     (not (tags "SOMEDAY"))
          ;;                     (not (scheduled))
          ;;                     (not (deadline)))
          ;;               ((org-ql-block-header "Waiting")
          ;;                (org-super-agenda-header-separator "")
          ;;                (org-super-agenda-groups '((:auto-priority)))))
                        ))
        ("ro" "Old Agenda and tasks"
         ((agenda "Agenda"
                  ((org-agenda-use-time-grid t)
                   (org-deadline-warning-days 3)
                   (org-agenda-span '1)
                   (org-agenda-start-day (org-today))))
          (org-ql-block '(and (todo)
                              (not (tags "SOMEDAY"))
                              (not (and (todo "TODO")
                                        (ancestors (todo "PROJ"))))
                              (not (scheduled))
                              (not (deadline)))
                        ((org-super-agenda-groups stfl/org-super-agenda-groups)
                         ;; TODO super-agenda to separate priorities
                         (org-ql-block-header "Tasks")
                         ;; TODO sort not yet possible: https://github.com/alphapapa/org-ql/pull/44
                         )
                        )))
        ))
#+end_src

#+RESULTS:
: ((b Agenda and tasks B+ ((agenda Agenda ((org-agenda-use-time-grid t) (org-deadline-warning-days 1) (org-agenda-span '1) (org-agenda-start-day (org-today)))) (org-ql-block '(and (todo NEXT) (or (and (tags org_jira) (property assignee Stefan Lendl)) (and (not (tags org_jira)) (or (priority >= C) (ancestors (priority >= C)) (deadline auto) (ancestors (deadline auto))))) (not (tags SOMEDAY)) (not (scheduled)) (not (habit))) ((org-ql-block-header Next Actions) (org-super-agenda-header-separator ) (org-deadline-warning-days 7) (org-super-agenda-groups stfl/priority-groups))) (org-ql-block '(and (todo PROJ) (priority >= B) (not (tags SOMEDAY)) (not (children (and (todo NEXT WAIT) (not (tags SOMEDAY)))))) ((org-ql-block-header Stuck Projects) (org-super-agenda-header-separator ) (org-super-agenda-groups stfl/priority-groups))) (org-ql-block '(and (todo WAIT) (or (priority >= B) (ancestors (priority >= B)) (deadline auto) (ancestors (deadline auto))) (not (tags SOMEDAY)) (not (scheduled))) ((org-ql-block-header Waiting) (org-super-agenda-header-separator ) (org-deadline-warning-days 7) (org-super-agenda-groups stfl/priority-groups))))) (c Agenda and tasks C+ ((agenda Agenda ((org-agenda-use-time-grid t) (org-deadline-warning-days 1) (org-agenda-span '1) (org-agenda-start-day (org-today)))) (org-ql-block '(and (todo NEXT) (or (and (tags org_jira) (property assignee Stefan Lendl)) (and (not (tags org_jira)) (or (priority >= C) (ancestors (priority >= C)) (deadline auto) (ancestors (deadline auto))))) (not (tags SOMEDAY)) (not (scheduled)) (not (habit))) ((org-ql-block-header Next Actions) (org-super-agenda-header-separator ) (org-deadline-warning-days 14) (org-super-agenda-groups stfl/priority-groups))) (org-ql-block '(and (todo PROJ) (priority >= C) (not (tags SOMEDAY)) (not (children (and (todo NEXT WAIT) (not (tags SOMEDAY)))))) ((org-ql-block-header Stuck Projects) (org-super-agenda-header-separator ) (org-super-agenda-groups stfl/priority-groups))) (org-ql-block '(and (todo WAIT) (or (priority >= C) (ancestors (priority >= C)) (deadline auto) (ancestors (deadline auto))) (not (tags SOMEDAY)) (not (scheduled))) ((org-ql-block-header Waiting) (org-super-agenda-header-separator ) (org-deadline-warning-days 14) (org-super-agenda-groups stfl/priority-groups))))) (d Agenda and tasks D+ ((agenda Agenda ((org-agenda-use-time-grid t) (org-deadline-warning-days 1) (org-agenda-span '1) (org-agenda-start-day (org-today)))) (org-ql-block '(and (todo NEXT) (or (and (tags org_jira) (property assignee Stefan Lendl)) (and (not (tags org_jira)) (or (priority >= C) (ancestors (priority >= C)) (deadline auto) (ancestors (deadline auto))))) (not (tags SOMEDAY)) (not (scheduled)) (not (habit))) ((org-ql-block-header Next Actions) (org-super-agenda-header-separator ) (org-deadline-warning-days 14) (org-super-agenda-groups stfl/priority-groups))) (org-ql-block '(and (todo PROJ) (priority >= D) (not (tags SOMEDAY)) (not (children (and (todo NEXT WAIT) (not (tags SOMEDAY)))))) ((org-ql-block-header Stuck Projects) (org-super-agenda-header-separator ) (org-super-agenda-groups stfl/priority-groups))) (org-ql-block '(and (todo WAIT) (or (priority >= D) (ancestors (priority >= D)) (deadline auto) (ancestors (deadline auto))) (not (tags SOMEDAY)) (not (scheduled))) ((org-ql-block-header Waiting) (org-super-agenda-header-separator ) (org-deadline-warning-days 14) (org-super-agenda-groups stfl/priority-groups))))) (a Agenda Weekly ((agenda  ((org-agenda-span 'week) (org-agenda-start-on-weekday 1))))) (r . Weekly Review) (rc Close the last week and finish done tasks ((org-ql-block '(and (todo NEXT) (not (tags SOMEDAY HABIT)) (not (scheduled)) (not (habit)) (or (not (deadline)) (deadline auto) (ancestors (deadline auto)))) ((org-ql-block-header Next Actions) (org-super-agenda-header-separator ) (org-deadline-warning-days 30) (org-super-agenda-groups stfl/priority-groups))) (org-ql-block '(and (todo WAIT) (not (tags SOMEDAY)) (not (scheduled)) (or (not (deadline)) (deadline auto) (ancestors (deadline auto)))) ((org-ql-block-header Waiting) (org-super-agenda-header-separator ) (org-deadline-warning-days 30) (org-super-agenda-groups stfl/priority-groups))) (org-ql-block '(and (todo PROJ) (not (tags SOMEDAY)) (not (children (and (todo NEXT WAIT) (not (tags SOMEDAY)))))) ((org-ql-block-header Stuck Projects) (org-super-agenda-header-separator ) (org-deadline-warning-days 30) (org-super-agenda-groups stfl/priority-groups))))) (rl Agenda Weekly with Log ((agenda  ((org-agenda-span 'week) (org-agenda-start-on-weekday 1) (org-agenda-archives-mode t) (org-agenda-start-with-log-mode '(closed)) (org-agenda-show-log t) (org-agenda-skip-function '(org-agenda-skip-entry-if 'notregexp ^.*DONE )))))) (rp Plan Projects ((org-ql-block '(and (todo PROJ) (not (tags SOMEDAY)) (not (children (and (todo NEXT WAIT) (tags SOMEDAY)))) (or (not (deadline)) (deadline auto) (ancestors (deadline auto)))) ((org-ql-block-header Projects) (org-super-agenda-header-separator ) (org-deadline-warning-days 45) (org-super-agenda-groups stfl/priority-groups))))) (rn Plan Next Actions ((org-ql-block '(and (todo NEXT) (not (tags SOMEDAY)) (not (scheduled)) (not (habit)) (or (not (deadline)) (deadline auto) (ancestors (deadline auto)))) ((org-ql-block-header Next Actions) (org-super-agenda-header-separator ) (org-deadline-warning-days 14) (org-super-agenda-groups stfl/priority-groups))))) (rs Stuck Projects ((org-ql-block '(and (todo PROJ) (not (tags SOMEDAY)) (not (children (and (todo NEXT WAIT) (not (tags SOMEDAY)))))) ((org-ql-block-header Stuck Projects) (org-super-agenda-header-separator ) (org-super-agenda-groups stfl/priority-groups))))) (rS SOMEDAY ((org-ql-block '(and (todo PROJ) (or (and (priority <= D) (not (ancestors (priority > D))) (not (children (priority > D)))) (tags SOMEDAY) (children (and (todo NEXT WAIT) (tags SOMEDAY)))) (not (scheduled)) (not (habit)) (not (deadline))) ((org-ql-block-header Projects) (org-super-agenda-header-separator ) (org-super-agenda-groups '((:tag SOMEDAY :order 10) (:auto-priority))))) (org-ql-block '(and (todo NEXT) (or (and (priority <= D) (not (ancestors (priority > D)))) (tags SOMEDAY)) (not (scheduled)) (not (habit)) (not (deadline))) ((org-ql-block-header Next Actions) (org-super-agenda-header-separator ) (org-super-agenda-groups '((:tag SOMEDAY :order 10) (:auto-priority))))))) (ro Old Agenda and tasks ((agenda Agenda ((org-agenda-use-time-grid t) (org-deadline-warning-days 3) (org-agenda-span '1) (org-agenda-start-day (org-today)))) (org-ql-block '(and (todo) (not (tags SOMEDAY)) (not (and (todo TODO) (ancestors (todo PROJ)))) (not (scheduled)) (not (deadline))) ((org-super-agenda-groups stfl/org-super-agenda-groups) (org-ql-block-header Tasks))))))

#+begin_src elisp
(setq stfl/priority-groups
     '((:tag "SOMEDAY" :order 90)
       (:name "MUST Do this week"
        :priority "A"
        :and (:tag "org_jira"
              :property ("status" "In Progress"))
        )
       (:name "SHOULD Do this week"
        :priority "B"
        :and (:tag "org_jira"
              :property ("status" "Planned"))
        )
       (:name "Optional or consider for next week"
        :priority "C"
        )
       (:name "I care a bit more"
        :priority "D"
        )
       (:name "Consider for SOMEDAY"
        :order 80
        :priority "E"
        )
       (:name "Backlog"
        :not
        :priority
        )
          ))
#+end_src

#+begin_src elisp
(setq org-agenda-diary-file "~/.org/diary.org"
      ;; org-agenda-dim-blocked-tasks t
      org-agenda-dim-blocked-tasks 'invisible
      org-agenda-use-time-grid t
      ;; org-agenda-hide-tags-regexp "\\w+"
      org-agenda-compact-blocks nil
      org-agenda-block-separator ""
      org-agenda-tags-column 0
      org-agenda-skip-scheduled-if-done t
      org-agenda-skip-unavailable-files t
      org-agenda-skip-deadline-if-done t
      org-agenda-skip-timestamp-if-done t
      org-agenda-window-setup 'current-window
      org-agenda-start-on-weekday nil
      org-agenda-span 'day
      org-agenda-start-day "-0d"
      org-deadline-warning-days 7
      org-agenda-show-future-repeats t
      org-agenda-skip-deadline-prewarning-if-scheduled nil
      org-agenda-tags-todo-honor-ignore-options 1
      ;; org-agenda-todo-ignore-with-date nil
      ;; org-agenda-todo-ignore-deadlines nil
      ;; org-agenda-todo-ignore-timestamp nil
      org-agenda-todo-list-sublevels t
      org-agenda-include-deadlines t
      )
#+end_src

Setting up my initial agenda settings
#+BEGIN_SRC elisp
(after! org (setq
                  org-enforce-todo-checkbox-dependencies nil
                  org-enforce-todo-dependencies nil
                  org-habit-show-habits t))

(after! org (setq org-agenda-files '("~/.org/gtd/inbox.org"
                                     ;; "~/.org/gtd/someday.org"
                                     "~/.org/gtd/tickler.org"
                                     "~/.org/calendar.org"
                                     "~/.org/gtd/todo.org"
                                     "~/.org/jira/active.org"
                                     "~/.org/gtd/projects/")))
;; (append (file-expand-wildcards "~/.org/gtd/*.org")
;;         (file-expand-wildcards "~/.org/gtd/projects/*.org"))))

;; (after! org
;;   (setq org-agenda-files '("~/.org/gtd/inbox.org"
;;                            "~/.org/gtd/projects.org"
;;                            "~/.org/gtd/tickler.org"))
#+END_SRC

Adjusting clock settings
#+BEGIN_SRC elisp
(after! org
  (setq! org-clock-continuously t))
#+END_SRC


#+BEGIN_SRC elisp
(defun skip-all-siblings-but-first-next-action ()
  "Skip all but the first non-done entry."
  (let (should-skip-entry)
    (unless (org-current-is-todo)
      (setq should-skip-entry t))
    (save-excursion
      (while (and (not should-skip-entry) (org-goto-sibling t))
        (when (org-current-is-next-action)
          (setq should-skip-entry t))))
    (when should-skip-entry
      (or (outline-next-heading)
          (goto-char (point-max))))))

(defun org-current-is-next-action ()
  (string= "NEXT" (org-get-todo-state)))

(defun org-current-is-todo ()
  (string= "TODO" (org-get-todo-state)))
#+END_SRC

** org super agenda
:PROPERTIES:
:ID:       e2830ec6-a2f9-4778-9bb2-f6d130ef61d2
:END:

#+begin_src elisp
(use-package! org-super-agenda
  :after (org-agenda evil-org-agenda)
  :config
  (org-super-agenda-mode)
  (setq org-super-agenda-header-separator "")

  (setq stfl/org-super-agenda-groups
        '((:name "Today"
           :deadline past
           :deadline today
           :scheduled today
           :scheduled past)
          (:name "Next Actions" :todo "NEXT")
          (:name "Waiting" :todo "WAIT")
          (:name "Projects"
           :and (:todo "PROJ"
                 :children ("NEXT"))
           :order 5)
          (:name "Waiting Projects"
           :and (:todo "PROJ"
                 :children ("WAIT"))
           :order 6)
          (:name "Stuck Projects"   ;; the rest but show before Projects
           :todo "PROJ"
           :order 4)))

  ;; Update ‘org-super-agenda-header-map’

(setq org-super-agenda-header-map evil-org-agenda-mode-map))
#+end_src

** org-ql
:PROPERTIES:
:ID:       617698c9-8d19-4dd5-a13f-541fa6a8c343
:END:

#+begin_src elisp
(defun stfl/org-ql-min-ancestor-priority< (a b)
  "Return non-nil if A's minimum ancestor priority is higher than B's.
A and B are Org headline elements.
org-default-priority is treated as lower than the same set value"
  (cl-macrolet ((priority (item)
                          `(org-with-point-at (org-element-property :org-marker ,item)
                             (stfl/org-min-ancestor-priority))))
    ;; NOTE: Priorities are numbers in Org elements.  This might differ from the priority selector logic.
    (let ((a-priority (priority a))
          (b-priority (priority b)))
      (cond ((and a-priority b-priority)
             (< a-priority b-priority))
            (a-priority t)
            (b-priority nil)))))


(defun stfl/org-min-ancestor-priority ()
  (cl-loop minimize (save-match-data (stfl/org-priority-or-default))
           while (and (not (equal "PROJ" (nth 2 (org-heading-components))))
                      (org-up-heading-safe))))


(defun stfl/org-priority-or-default ()
  (let* ((prio-raw (org-element-property :priority (org-element-at-point)))
         (prio (cond (prio-raw prio-raw)
                     (t (+ 0.5 org-priority-default))))) ;;
    display empty prio below default prio))
#+end_src

** Capture Templates
:PROPERTIES:
:ID:       6a1cd4f6-e2a2-4838-b451-61589e3cdbef
:END:
Here we setup the capture templates we want for ~org-capture~. I use a file template that's pre-filled with my monthly scheduled transactions. (TODO: Add default file-template for new projects.)
#+BEGIN_SRC elisp
(after! org
  (setq org-capture-templates
        '(
          ("n" "capture to inbox"
           entry
           (file+headline "~/.org/gtd/inbox.org" "Inbox")
           (file "~/.doom.d/templates/template-inbox.org"))
          ("p" "Project"
           entry
           (file+headline "~/.org/gtd/inbox.org" "Inbox")
           (file "~/.doom.d/templates/template-projects.org")
           :empty-lines-after 1)
          ("s" "scheduled"
           entry
           (file+headline "~/.org/gtd/inbox.org" "Inbox")
           (file "~/.doom.d/templates/template-scheduled.org"))
          ("S" "deadline"
           entry
           (file+headline "~/.org/gtd/inbox.org" "Inbox")
           (file "~/.doom.d/templates/template-inbox.org"))
          ("P" "Protocol"
           plain
           (file "~/.org/gtd/inbox.org")
           "* %^{Title}\nSource: [[%:link][%(transform-square-brackets-to-round-ones \"%:description\")]]\n:PROPERTIES:\n:CREATED: %U\n:END:\n#+BEGIN_QUOTE\n%i\n#+END_QUOTE\n\n%?"
           :empty-lines-after 1)
          ("L" "Protocol Link"
           plain
           (file "~/.org/gtd/inbox.org")
           "* [[%:link][%:description]]\n:PROPERTIES:\n:CREATED: %U\n:END:\n%?"
           :empty-lines-after 1)
          )
        ))
#+END_SRC

update brackets when copying a link from org-protocol
#+BEGIN_SRC elisp
(defun transform-square-brackets-to-round-ones(string-to-transform)
  "Transforms [ into ( and ] into ), other chars left unchanged."
  (concat
  (mapcar #'(lambda (c) (if (equal c ?\[) ?\( (if (equal c ?\]) ?\) c))) string-to-transform))
  )
#+END_SRC

** Archive
:PROPERTIES:
:ID:       8d07f343-cde2-4a1c-9700-d0ae563823d3
:END:
#+BEGIN_SRC elisp
(after! org
  (setq org-image-actual-width 400
        org-archive-location "~/.org/gtd/archive/%s::datetree"
        ))
#+END_SRC

** org-habit
:PROPERTIES:
:ID:       d7e8ca81-775d-4623-ae1e-665181143649
:END:

load org-habit because many of the functions in ~org-helpers.el~ require it...
#+BEGIN_SRC elisp
(use-package! org-habit
  :after org-agenda
  :config
  (add-to-list 'org-modules 'org-habit)

  (setq org-habit-preceding-days 14
        org-habit-following-days 7)

  ;; Length of the habit graph
  (setq org-habit-graph-column 31))
#+END_SRC

** Task Dependencies (org-edna)
:PROPERTIES:
:ID:       39318530-055d-492b-8cde-5cd379602ea6
:END:
Extensible Dependencies ’N’ Actions (EDNA) for Org Mode tasks
#+BEGIN_SRC elisp
(use-package! org-edna
  :after org
  ;; :config (org-edna-mode)
  :hook org-mode-hook
  )

;; (add-hook 'org-mode-hook 'org-edna-mode)
#+END_SRC

Some functions to quickly add TRIGGER and BLOCKER properties
#+BEGIN_SRC elisp
(defun stfl/trigger-next-sibling-NEXT ()
  (interactive)
  (org-entry-put nil "TRIGGER" "next-sibling todo!(NEXT)"))

(defun stfl/blocker-previous-sibling ()
  (interactive)
  (org-entry-put nil "BLOCKER" "previous-sibling"))

(defun stfl/trigger-next-and-blocker-previous ()
  (interactive)
  (stfl/trigger-next-sibling-NEXT)
  (stfl/blocker-previous-sibling))

(map! :after org
      :map org-mode-map
      :localleader
      :prefix ("d" . "date/dateline/dependencies")
      :desc "next-sibling NEXT" "n" 'stfl/trigger-next-sibling-NEXT
      :desc "trigger NEXT and block prev" "b" 'stfl/trigger-next-and-blocker-previous
      )
#+END_SRC

** Keywords
:PROPERTIES:
:ID:       c7d94cf2-b4f1-4d87-8887-cf477260b432
:END:
After much feedback and discussing with other users, I decided to simplify the keyword list to make it simple. Defining a project will now focus on the tag word *:project:* so that all child task are treated as part of the project.
| Keyword | Description                                                  |
|---------+--------------------------------------------------------------|
| TODO    |                                                              |
| PROJ    | Task has actionable items defined and ready to be worked.    |
| HOLD    | Has actionable items, but is on hold due to various reasons. |
| WAIT    | Waiting for something                                        |
| NEXT    | Is ready to be worked and should be worked on soon.          |
| DONE    | Task is completed and closed.                                |
| KILL    | Abandoned or terminated.                                     |

#+BEGIN_SRC elisp
(custom-declare-face '+org-todo-active  '((t (:inherit (bold font-lock-constant-face org-todo)))) "")
(custom-declare-face '+org-todo-project '((t (:inherit (bold font-lock-doc-face org-todo)))) "")
(custom-declare-face '+org-todo-onhold  '((t (:inherit (bold warning org-todo)))) "")
(custom-declare-face '+org-todo-next '((t (:inherit (bold font-lock-keyword-face org-todo)))) "")
(custom-declare-face 'org-checkbox-statistics-todo '((t (:inherit (bold font-lock-constant-face org-todo)))) "")
#+end_src

[[https://orgmode.org/manual/Tracking-TODO-state-changes.html#Tracking-TODO-state-changes][Tracking TODO state changes]]

#+begin_src elisp
(after! org
  (setq org-todo-keywords
        '((sequence
           "TODO(t)"  ; A task that needs doing & is ready to do
           "PROJ(p)"  ; Project with multiple task items.
           "NEXT(n)"  ; Task is next to be worked on.
           "WAIT(w)"  ; Something external is holding up this task
           "|"
           "DONE(d@)"  ; Task successfully completed
           "KILL(k@)")) ; Task was cancelled, aborted or is no longer applicable
        org-todo-keyword-faces
        '(("WAIT" . +org-todo-onhold)
          ("PROJ" . +org-todo-project)
          ("TODO" . +org-todo-active)
          ("NEXT" . +org-todo-next)))
)
#+END_SRC


Increase indenation in org-indent
#+BEGIN_SRC elisp
(after! org (setq org-indent-indentation-per-level 4))
#+END_SRC

Remove TODO keywrods from org-mode (it will still work in agenda)
#+BEGIN_SRC elisp
;; (set-ligatures! 'org-mode
;;     :alist '(("TODO " . "")
;;              ("NEXT " . "")
;;              ("PROJ " . "")
;;              ("WAIT " . "")
;;              ("DONE " . "")
;;              ("KILL " . "")))
#+END_SRC

#+begin_src elisp
(set-ligatures! 'org-mode
    :alist '((":PROPERTIES:" . "⏍")
             (":properties:" . "⏍")
             (":LOGBOOK:" . "㏒")
             (":logbook:" . "㏒")
             ))
#+end_src

[[https://gist.github.com/mskorzhinskiy/8076d3a82fb78650088b7fa7243f08aa][Doom emacs org-mode ricing]]
Org-superstar config
#+BEGIN_SRC elisp
(after! org-superstar
  ;; Every non-TODO headline now have no bullet
  ;; (setq org-superstar-headline-bullets-list '("　"))
  (setq org-superstar-leading-bullet ?　)
  ;; Enable custom bullets for TODO items
  (setq org-superstar-special-todo-items t)
  (setq org-superstar-todo-bullet-alist
        '(("TODO" "☐")
          ("NEXT" "➡")
          ("PROJ" "⎚")
          ("WAIT" "⏳")
          ("KILL" "✘")
          ("DONE" "✔")))
  (org-superstar-restart))
#+END_SRC

** Logging and Drawers
:PROPERTIES:
:ID:       28e25bba-6724-4710-b3b9-570cc8da948c
:END:

For the logging drawers, we like to keep our notes and clock history *seperate* from our properties drawer...
#+BEGIN_SRC elisp
(after! org (setq org-log-state-notes-insert-after-drawers nil))
#+END_SRC

Next, we like to keep a history of our activity of a task so we *track* when changes occur, and we also keep our notes logged in *their own drawer*. Optionally you can also add the following in-buffer settings to override the =org-log-into-drawer= function. ~#+STARTUP: logdrawer~ or ~#+STARTUP: nologdrawer~
#+BEGIN_SRC elisp
(after! org
  (setq org-log-into-drawer t
        org-log-done 'time+note
        org-log-repeat 'time
        org-log-redeadline 'time
        org-log-reschedule 'time
        ))
#+END_SRC

** Properties
:PROPERTIES:
:ID:       6ed1956f-d162-4dd0-a755-8d684cebc681
:END:
#+BEGIN_SRC elisp
(after! org
  (setq org-use-property-inheritance t ; We like to inherit properties from their parents
        org-catch-invisible-edits 'error ; Catch invisible edits
        org-track-ordered-property-with-tag t
        org-hierarchical-todo-statistics nil
        ))
#+END_SRC

** Refiling
:PROPERTIES:
:ID:       b1208906-9e44-4a2e-a21c-e169a7e3486c
:END:

refile target -> build list of someday files dynamically
#+BEGIN_SRC elisp
(defun stfl/build-my-someday-files ()
  (file-expand-wildcards "~/.org/gtd/someday/*.org"))

(after! org
  (setq org-refile-targets '((nil :maxlevel . 9)
                             (org-agenda-files :maxlevel . 4)
                             ("~/.org/gtd/someday.org" :maxlevel . 4)
                             (stfl/build-my-someday-files :maxlevel . 4))
        org-refile-use-outline-path 'buffer-name
        org-outline-path-complete-in-steps nil
        org-refile-allow-creating-parent-nodes 'confirm))
#+end_src

refile to roam files by
#+begin_src elisp
(defun stfl/build-my-roam-files () (file-expand-wildcards "~/.org/roam/**/*.org"))

(defun stfl/refile-to-roam ()
  (interactive)
  (let ((org-refile-targets '((stfl/build-my-roam-files :maxlevel . 1))))
    (call-interactively 'org-refile)))
#+END_SRC

[[https://org-roam.discourse.group/t/creating-an-org-roam-note-from-an-existing-headline/978][Creating an org-roam note from an existing headline]]
#+begin_src elisp
(defun org-roam-create-note-from-headline ()
  "Create an Org-roam note from the current headline and jump to it.

Normally, insert the headline’s title using the ’#title:’ file-level property
and delete the Org-mode headline. However, if the current headline has a
Org-mode properties drawer already, keep the headline and don’t insert
‘#+title:'. Org-roam can extract the title from both kinds of notes, but using
‘#+title:’ is a bit cleaner for a short note, which Org-roam encourages."
  (interactive)
  (let ((title (nth 4 (org-heading-components)))
        (has-properties (org-get-property-block)))
    (org-cut-subtree)
    (org-roam-find-file title nil nil 'no-confirm)
    (org-paste-subtree)
    (unless has-properties
      (kill-line)
      (while (outline-next-heading)
        (org-promote)))
    (goto-char (point-min))
    (when has-properties
      (kill-line)
      (kill-line))))
#+end_src

** Default Tags
:PROPERTIES:
:ID:       37ad2d09-7250-443e-9bbd-26c3b4305b72
:END:
REVIEW should we define any additional tags?
#+BEGIN_SRC elisp
(after! org
  (setq org-tag-alist '((:startgrouptag)
                        ("Context" . nil)
                        (:grouptags)
                        ("@home" . ?h)
                        ("@office". ?o)
                        ("@sarah" . ?s)
                        ("@robert" . ?r)
                        ("@baudock_meeting" . ?b)
                        ("@PC" . ?p)
                        ("@phone" . ?f)
                        (:endgrouptag)
                        ;; (:startgrouptag)
                        ;; ("Categories" . nil)
                        ;; (:grouptags)
                        ;; ("wohnung")
                        ;; ("health")
                        ;; ("bike")
                        ;; ("friends")
                        ;; ("emacs")
                        ;; ("gtd")
                        ;; ("shopping")
                        ;; ("learning")
                        ;; (:endgrouptag)
                        (:startgrouptag)
                        ("Process" . nil)
                        (:grouptags)
                        ("SOMEDAY" . ?S)
                        ("REFILE" . ?R)
                        ("TICKLER" . ?T)
                        ("DELIGATED" . ?D)
                        ("HABIT" . ?H)
                        (:endgrouptag)
                        (:startgrouptag)
                        ("Areas" . nil)
                        (:grouptags)
                        ("pulswerk" . ?$)
                        ("#personal" . ?_)
                        )))
#+END_SRC

** Prompt for headline when creating ID links
:PROPERTIES:
:ID:       e15a800b-991a-456d-bbf9-523789d6d259
:END:
#+BEGIN_SRC emacs-lisp
(defun nm/org-id-prompt-id ()
  "Prompt for the id during completion of id: link."
  (let ((dest (org-refile-get-location))
        (name nil)
        (id nil))
    (save-excursion
      (find-file (cadr dest))
      (goto-char (nth 3 dest))
      (setq id (org-id-get (point) t)
            name (org-get-heading t t t t)))
    (org-insert-link nil (concat "id:" id) name)))

(after! org
  (org-link-set-parameters "id" :complete #'nm/org-id-prompt-id))
#+END_SRC

** Org-Roam
:PROPERTIES:
:ID:       812f2cef-61c0-4299-907d-a601e577f59d
:END:
These are my default ROAM settings
#+BEGIN_SRC elisp
(setq! org-roam-tag-sources '(prop last-directory)
       org-roam-db-location "~/.emacs.d/roam.db"
       org-roam-directory "~/.org/")

(setq! org-roam-file-exclude-regexp "*/.stversions/*")
;; (add-to-list 'safe-local-variable-values '(org-roam-directory . "."))

(setq org-roam-dailies-capture-templates
   '(("d" "daily" plain (function org-roam-capture--get-point) ""
      :immediate-finish t
      :file-name "roam/journal/%<%Y-%m-%d-%a>"
      :head "#+TITLE: %<%Y-%m-%d %a>\n#+STARTUP: content\n\n")))

(setq org-roam-capture-templates
        '(("f" "fleeting" plain (function org-roam-capture--get-point)
           "%?"
           :file-name "roam/fleeting/${slug}"
           :head "#+title: ${title}\n#+roam_tags: %^{tags}\n\n"
           :unnarrowed t)
          ("p" "private" plain (function org-roam-capture--get-point)
           "%?"
           :file-name "roam/private/${slug}"
           :head "#+title: ${title}\n"
           :unnarrowed t)
          ("c" "coding" plain (function org-roam-capture--get-point)
           "%?"
           :file-name "roam/coding/${slug}"
           :head "#+title: ${title}\n#+roam_tags: %^{tags}\n\n"
           :unnarrowed t)
           ))
#+END_SRC

rebuild org-roam cache at start

#+begin_src elisp
;; (after! org-roam (org-roam-db-build-cache))
#+end_src

** Roam Server
:PROPERTIES:
:ID:       028dcbe8-0ac1-4ebc-a4c8-abf491516b29
:END:
#+BEGIN_SRC elisp
;; (use-package! org-roam-server
;;   ;; :ensure t
;;   :after org-roam
;;   :config
;;   (setq org-roam-server-host "127.0.0.1"
;;         org-roam-server-port 7070
;;         org-roam-server-export-inline-images t
;;         org-roam-server-authenticate nil
;;         org-roam-server-network-poll nil
;;         org-roam-server-network-arrows 'from
;;         org-roam-server-network-label-truncate t
;;         org-roam-server-network-label-truncate-length 60
;;         org-roam-server-network-label-wrap-length 20)

;;   ;; (org-roam-server-mode)
;;   )
#+END_SRC

** Roam Export Backlinks + Content
:PROPERTIES:
:ID:       e29a30f2-f6ae-43f3-a39d-26caa15dec61
:END:
#+BEGIN_SRC elisp
(defun my/org-roam--backlinks-list-with-content (file)
  (with-temp-buffer
    (if-let* ((backlinks (org-roam--get-backlinks file))
              (grouped-backlinks (--group-by (nth 0 it) backlinks)))
        (progn
          (insert (format "\n\n* %d Backlinks\n"
                          (length backlinks)))
          (dolist (group grouped-backlinks)
            (let ((file-from (car group))
                  (bls (cdr group)))
              (insert (format "** [[file:%s][%s]]\n"
                              file-from
                              (org-roam--get-title-or-slug file-from)))
              (dolist (backlink bls)
                (pcase-let ((`(,file-from _ ,props) backlink))
                  (insert (s-trim (s-replace "\n" " " (plist-get props :content))))
                  (insert "\n\n")))))))
    (buffer-string)))

(defun my/org-export-preprocessor (backend)
  (let ((links (my/org-roam--backlinks-list-with-content (buffer-file-name))))
    (unless (string= links "")
      (save-excursion
        (goto-char (point-max))
        (insert (concat "\n* Backlinks\n") links)))))

(add-hook 'org-export-before-processing-hook 'my/org-export-preprocessor)
#+END_SRC

** org-gcal
:PROPERTIES:
:ID:       f1d8ded8-e6be-461e-a593-160f6b275574
:END:
#+BEGIN_SRC elisp
(use-package! org-gcal
  :commands (org-gcal-sync
             org-gcal-fetch
             org-gcal-post-at-point
             org-gcal-delete-at-point)
  ;; :init
  ;; (defvar org-gcal-dir (concat doom-cache-dir "org-gcal/"))
  ;; (defvar org-gcal-token-file (concat org-gcal-dir "token.gpg"))
  :config
  ;; hack to avoid the deferred.el error
  (defun org-gcal--notify (title mes)
    (message "org-gcal::%s - %s" title mes))
  (setq org-gcal-client-id (get-auth-info "org-gcal-client-id" "ste.lendl@gmail.com")
        org-gcal-client-secret (get-auth-info "org-gcal-client-secret" "ste.lendl@gmail.com")
        org-gcal-fetch-file-alist '(("ste.lendl@gmail.com" .  "~/.org/calendar.org"))))
#+END_SRC

#+begin_src elisp
(map!
 :map org-mode-map
 :leader
 (:prefix ("n" . "notes")
  (:prefix ("j" . "sync")
   :desc "sync Google Calendar" "g" #'org-gcal-sync
   )))
#+end_src

** Drawing Diagrams with Mermaid
:PROPERTIES:
:ID:       819cb74f-3d27-4a76-bb81-06b9d1b714b5
:END:
Org babel to generate mermaid diagrams from org src blocks

#+begin_src elisp
(use-package! ob-mermaid
  :after org
  :init
        (setq ob-mermaid-cli-path "/home/stefan/.yarn/bin/mmdc")
  :config
        (add-to-list 'org-babel-load-languages '(mermaid . t))
  )
#+end_src

** Resolve syncthing conflicts

From https://www.reddit.com/r/emacs/comments/bqqqra/quickly_find_syncthing_conflicts_and_resolve_them/ In termux, you also need to pkg install diffutils.


#+begin_src elisp
(map! :after org
      :map org-mode-map
      :leader
      (:prefix ("n" . "notes")
       (:prefix ("j" . "sync")
        :desc "resolve syncthing conflicts" "c" #'stfl/resolve-orgzly-syncthing
        )))
#+end_src

#+begin_src elisp
(defun stfl/resolve-orgzly-syncthing ()
  (interactive)
  (ibizaman/syncthing-resolve-conflicts "~/.org/"))

(defun ibizaman/syncthing-resolve-conflicts (directory)
  "Resolve all conflicts under given DIRECTORY."
  (interactive "D")
  (let* ((all (ibizaman/syncthing--get-sync-conflicts directory))
         (chosen (ibizaman/syncthing--pick-a-conflict all)))
    (ibizaman/syncthing-resolve-conflict chosen)))


(defun ibizaman/syncthing-show-conflicts-dired (directory)
  "Open dired buffer at DIRECTORY showing all syncthing conflicts."
  (interactive "D")
  (find-name-dired directory "*.sync-conflict-*"))

(defun ibizaman/syncthing-resolve-conflict-dired (&optional arg)
  "Resolve conflict of first marked file in dired or close to point with ARG."
  (interactive "P")
  (let ((chosen (car (dired-get-marked-files nil arg))))
    (ibizaman/syncthing-resolve-conflict chosen)))

(defun ibizaman/syncthing-resolve-conflict (conflict)
  "Resolve CONFLICT file using ediff."
  (let* ((normal (ibizaman/syncthing--get-normal-filename conflict)))
    (ibizaman/ediff-files
     (list conflict normal)
     `(lambda ()
        (when (y-or-n-p "Delete conflict file? ")
          (kill-buffer (get-file-buffer ,conflict))
          (delete-file ,conflict))))))

(defun ibizaman/syncthing--get-sync-conflicts (directory)
  "Return a list of all sync conflict files in a DIRECTORY."
  (seq-filter (lambda (o) (not (string-match "\\.stversions" o))) (directory-files-recursively directory "\\.sync-conflict-")))

(defvar ibizaman/syncthing--conflict-history nil
  "Completion conflict history")

(defun ibizaman/syncthing--pick-a-conflict (conflicts)
  "Let user choose the next conflict from CONFLICTS to investigate."
  (completing-read "Choose the conflict to investigate: " conflicts
                   nil t nil ibizaman/syncthing--conflict-history))

(defun ibizaman/syncthing--get-normal-filename (conflict)
  "Get non-conflict filename matching the given CONFLICT."
  (replace-regexp-in-string "\\.sync-conflict-.*\\(\\..*\\)$" "\\1" conflict))

(defun ibizaman/ediff-files (&optional files quit-hook)
  (interactive)
  (lexical-let ((files (or files (dired-get-marked-files)))
                (quit-hook quit-hook)
                (wnd (current-window-configuration)))
    (if (<= (length files) 2)
        (let ((file1 (car files))
              (file2 (if (cdr files)
                         (cadr files)
                       (read-file-name
                        "file: "
                        (dired-dwim-target-directory)))))
          (if (file-newer-than-file-p file1 file2)
              (ediff-files file2 file1)
            (ediff-files file1 file2))
          (add-hook 'ediff-after-quit-hook-internal
                    (lambda ()
                      (setq ediff-after-quit-hook-internal nil)
                      (when quit-hook (funcall quit-hook))
                      (set-window-configuration wnd))))
      (error "no more than 2 files should be marked"))))
#+end_src

* Module Settings
** Company mode
:PROPERTIES:
:ID:       7181a2a3-911a-480f-b8c7-6bb96d11edf1
:END:
#+BEGIN_SRC elisp
;; (after! org
;;   (set-company-backend! 'org-mode 'company-capf '(company-yasnippet company-org-roam company-elisp))
;;   (setq company-idle-delay 0.25))
#+END_SRC

** Define Word
:PROPERTIES:
:ID:       8ce8fe9c-bf84-469c-afcd-3e9fc5ecc167
:END:
#+BEGIN_SRC elisp
(use-package! define-word
  :after org
  :config
  (map! :after org
        :map org-mode-map
        :leader
        :desc "Define word at point" "@" #'define-word-at-point))
#+END_SRC

** Pandoc
:PROPERTIES:
:ID:       535b2018-8890-4e62-a293-a92df0734c07
:END:
#+BEGIN_SRC elisp
(setq org-pandoc-options '((standalone . t) (self-contained . t)))
#+END_SRC

** Projectile
:PROPERTIES:
:ID:       d4a31927-ff21-42a5-98e1-ed487a84a618
:END:
#+BEGIN_SRC elisp
(after! projectile
  ;; (setq projectile-project-search-path
  ;;       (cddr (directory-files "/work" t))) ;;add all dirs inside ~/work -> https://github.com/bbatsov/projectile/issues/1500
  (add-to-list 'projectile-globally-ignored-directories ".ccls-cache")
  )
#+END_SRC

** ediff
:PROPERTIES:
:ID:       c186f137-d99f-45ab-930b-297091895183
:END:
forcing text comparison even if diff thinks files are binary
#+begin_src elisp
(after! ediff
  (setq ediff-diff-options "--text"
        ediff-diff3-options "--text"
        ediff-toggle-skip-similar t
        ediff-diff-options "-w"
        ;; ediff-window-setup-function 'ediff-setup-windows-plain
        ediff-split-window-function 'split-window-horizontally))

#+end_src

** origami
:PROPERTIES:
:ID:       32d3c85e-c348-4265-bc29-324b3866131f
:END:
#+begin_src elisp
;; (use-package! origami)

;; (map! :after '(org-agenda origami)
;;       :map org-agenda-mode-map
;;       :desc "" "TAB" #'origami-toggle-node
;;       ;; :desc "" "" #'org-agenda-priority-tree-down
;;       )
#+end_src

* Custom Functions
:PROPERTIES:
:ID:       c2e19f11-90cd-4bc9-ad99-36a5a680c084
:END:
#+BEGIN_SRC elisp
(load! "org-customs.el")
(load! "org-helpers.el")
(load! "org-helpers-nm.el")
#+END_SRC

#+BEGIN_SRC elisp
;; (setq org-tasks-properties-metadata (list "SOURCE"))
;; (map! :after org
;;       :map org-mode-map
;;       :localleader
;;       :prefix ("j" . "nicks functions")
;;       :desc "Clarify properties" "c" #'nm/org-clarify-metadata)

;; (bind-key "<f7>" #'nm/org-capture-to-file)
#+END_SRC

set todo value to *PROJ* for all TODOs with sub-todos
#+BEGIN_SRC elisp
;; (add-hook 'before-save-hook #'nm/org-assign-tasks-proj)
#+END_SRC

* Coding
** LSP
:PROPERTIES:
:ID:       57007770-c5ba-40e9-a9af-3d2d8c835781
:END:
#+BEGIN_SRC elisp
(use-package! lsp-treemacs
  :after lsp-mode  ;; and treemacs
  :config (lsp-treemacs-sync-mode 1)
  )

;; improve performance of lsp-mode https://emacs-lsp.github.io/lsp-mode/page/performance/
(after! lsp-mode
  (setq read-process-output-max (* 1024 1024)) ;; 1mb
  (setq gc-cons-threshold 100000000)
  ;; (setq lsp-log-io t)
  )

(map! (:after lsp
       :map lsp-mode-map
       :leader
       :prefix ("c" . "+code")
       :desc "Diagnostic for Workspace" "X" #'lsp-treemacs-errors-list))
#+END_SRC

** PHP
:PROPERTIES:
:ID:       1a38710f-565e-4680-bc53-b39f3d955b71
:END:
#+BEGIN_SRC elisp
(after! (lsp-mode php-mode)
  (setq lsp-intelephense-licence-key (get-auth-info "intelephense" "ste.lendl@gmail.com"))
  (setq lsp-intelephense-files-associations '["*.php" "*.phtml" "*.inc"])
  (setq lsp-intelephense-files-exclude '["**update.php**" "**/js/**" "**/fonts/**" "**/gui/**" "**/upload/**"
                                         "**/.git/**" "**/.svn/**" "**/.hg/**" "**/CVS/**" "**/.DS_Store/**" "**/node_modules/**" "**/bower_components/**" "**/vendor/**/{Test,test,Tests,tests}/**"])
        ;; (get-auth-info "intelephense" "sutter"))
  ;; (setq lsp-intelephense-trace-server "verbose")
  ;; (setq lsp-intelephense-multi-root t)
  ;; (setq lsp-intelephense-clear-cache t)
  (setq lsp-auto-guess-root nil)
  (setq lsp-idle-delay 0.8)
  )
#+END_SRC

** MQL
:PROPERTIES:
:ID:       c3da477e-b64b-4a50-af87-5fdec1fd62ab
:END:
#+BEGIN_SRC elisp
(add-to-list 'auto-mode-alist '("\\.mq[45h]\\'" . cpp-mode))
#+END_SRC

** Gitlab-CI
:PROPERTIES:
:ID:       2e1016eb-5a16-464e-a8bb-2a458f26db3d
:END:

#+BEGIN_SRC elisp
(use-package! gitlab-ci-mode
  :mode ".gitlab-ci.yml"
  )

(use-package! gitlab-ci-mode-flycheck
  :after flycheck gitlab-ci-mode
  :init
  (gitlab-ci-mode-flycheck-enable))
#+END_SRC
** Kubernetes
:PROPERTIES:
:ID:       fd4fae8c-3a70-449f-b3d5-52c25f76ec0a
:END:

#+begin_src elisp
;; (use-package kubernetes
;;   :ensure t
;;   :commands (kubernetes-overview))
#+end_src

#+begin_src elisp
;; (use-package! kubernetes-evil
;;   :ensure t
;;   :after kubernetes)
#+end_src

** SQL
:PROPERTIES:
:ID:       4efebc11-28ba-4f18-a758-a4af693d6f69
:END:
#+begin_src elisp
(use-package! sql-indent
  :after sql-mode
)
#+end_src

*** Database Interface (edbi)
:PROPERTIES:
:ID:       e54ac6a8-7cf4-47ea-abe6-500512022534
:END:

[[roam:edbi setup]]

#+begin_src elisp
(use-package! edbi
  :commands 'edbi:open-db-viewer
  )
#+end_src

#+begin_src elisp

(use-package! edbi-minor-mode
  :after sql-mode
  :hook sql-mode-hook
  )
;; (add-hook 'sql-mode-hook 'edbi-minor-mode)
#+end_src

* Collaboration
** Directory tree diff
:PROPERTIES:
:ID:       74eab92f-af80-47ab-b6ac-0712d7e87699
:END:
#+BEGIN_SRC elisp
(use-package! ztree)
#+END_SRC

** Magit

*** Forge
:PROPERTIES:
:ID:       0ed4b14f-b9cd-4b13-b17e-633213db7418
:END:
display more columns in forge list topic
#+BEGIN_SRC elisp
(after! forge (setq forge-topic-list-columns
                    '(("#" 5 t (:right-align t) number nil)
                      ("Title" 60 t nil title  nil)
                      ("State" 6 t nil state nil)
                      ("Marks" 8 t nil marks nil)
                      ("Labels" 8 t nil labels nil)
                      ("Assignees" 10 t nil assignees nil)
                      ("Updated" 10 t nill updated nil))))
#+END_SRC

*** with-editor

# #+BEGIN_SRC elisp
# (use-package! with-editor
#   :after magit
#   :config
#   (define-key (current-global-map)
#     [remap async-shell-command] 'with-editor-async-shell-command)
#   (define-key (current-global-map)
#     [remap shell-command] 'with-editor-shell-command)

#   (add-hook 'shell-mode-hook  'with-editor-export-editor)
#   (add-hook 'term-exec-hook   'with-editor-export-editor)
#   (add-hook 'eshell-mode-hook 'with-editor-export-editor)

#   (add-hook 'shell-mode-hook 'with-editor-export-git-editor)
# )
# #+END_SRC


** Todoist integration
:PROPERTIES:
:ID:       d50f767a-e398-4ee8-ba42-e4d8bae3dd5f
:END:
#+BEGIN_SRC elisp
;; (after! todoist (setq todoist-token (get-auth-info "todoist" "stfl")))
#+END_SRC

#+RESULTS:

** org-jira
:PROPERTIES:
:ID:       9e6bc5aa-89b0-43f0-aad1-2c8212e0bae7
:END:
#+BEGIN_SRC elisp
(use-package! org-jira
  :after org
  :init (setq org-jira-working-dir "~/.org/jira/"
              jiralib-url "https://pulswerk.atlassian.net")
  ;; (defconst org-jira-progress-issue-flow
  ;;     '(("To Do" . "In Progress"
  ;;     ("In Progress" . "Done"))))
  :config
  (setq org-jira-jira-status-to-org-keyword-alist '(("To Do" . "TODO")
                                                    ("Planned" . "NEXT")
                                                    ("In Progress" . "NEXT")
                                                    ("Staging" . "DONE")
                                                    ("Ready" . "DONE")
                                                    ("Done" . "DONE"))
        org-jira-priority-to-org-priority-alist (list (cons "Highest" ?A)
                                                      (cons "High" ?B)
                                                      ;; (cons "Medium" ?D)  ;; no org priority for /default/
                                                      (cons "Low" ?E)
                                                      (cons "Lowest" ?E))

        org-jira-custom-jqls '((:jql "
assignee='Stefan Lendl'
AND status != Done
AND ( Sprint in openSprints()
      OR Project = MD)
ORDER BY priority, created DESC
"
           :limit 300
           :filename "active")))

  (map!
   :map org-mode-map
   :localleader
   :prefix ("j" . "Jira")
   :desc "Get issues from JQL" "j" #'org-jira-get-issues-from-custom-jql
   "n" #'org-jira-create-issue
   "p" #'org-jira-progress-issue
   "P" #'org-jira-progress-issue-next
   "a" #'org-jira-assign-issue
   "r" #'org-jira-refresh-issue
   "R" #'org-jira-refresh-issues-in-buffer
   "u" #'org-jira-update-issue
   "s" #'org-jira-create-subtask
   "S" #'org-jira-get-subtask
   "t" #'org-jira-todo-to-jira
   (:prefix ("c" . "Comments")
    :desc "Add Comment" "c" #'org-jira-add-comment
    :desc "Update Comment" "u" #'org-jira-update-comment
    ))

  (map!
   :map org-jira-map
   :leader
   (:prefix ("n" . "notes")
    (:prefix ("j" . "sync")
     :desc "Get issues from JQL" "j" #'org-jira-get-issues-from-custom-jql
     )))

  ;; "pg" #'org-jira-get-projects
  ;; "bg" #'org-jira-get-boards
  ;; "iv" #'org-jira-get-issues-by-board
  ;; "ib" #'org-jira-browse-issue
  ;; "ig" #'org-jira-get-issues
  ;; "ih" #'org-jira-get-issues-headonly
  ;; "iu" #'org-jira-update-issue
  ;; "iw" #'org-jira-progress-issue
  ;; "in" #'org-jira-progress-issue-next
  ;; "ia" #'org-jira-assign-issue
  ;; "ir" #'org-jira-refresh-issue
  ;; "iR" #'org-jira-refresh-issues-in-buffer
  ;; "ic" #'org-jira-create-issue
  ;; "ik" #'org-jira-copy-current-issue-key
  ;; "sc" #'org-jira-create-subtask
  ;; "sg" #'org-jira-get-subtasks
  ;; "cc" #'org-jira-add-comment
  ;; "cu" #'org-jira-update-comment
  ;; "wu" #'org-jira-update-worklogs-from-org-clocks
  ;; "tj" #'org-jira-todo-to-jira
  ;; "if" #'org-jira-get-issues-by-fixversion
  )

;; ("c if" #'org-jira-get-issues-from-filter-headonly
;; ("c iF" #'org-jira-get-issues-from-filter
;; (" isr" #'org-jira-set-issue-reporter
#+END_SRC

* literate config
** Don't auto-recompile literate-config
:PROPERTIES:
:ID:       7f52c1ee-6fff-4e04-96fa-8c5a2bf3ad14
:END:
#+BEGIN_SRC elisp
(remove-hook 'org-mode-hook #'+literate-enable-recompile-h)
#+END_SRC
** private config is config.org

~doom/goto-private-config-file~ goes to ~config.el~ which I will never edit by hand.
Opening ~config.org~ makes much more sense.

#+begin_src elisp
(defun stfl/goto-private-config-file ()
  "Open your private config.el file."
  (interactive)
  (find-file (expand-file-name "config.org" doom-private-dir)))
#+end_src

bind it to ~SPC h d c~

#+begin_src elisp
(define-key! help-map
  "dc"   #'stfl/goto-private-config-file
  )
#+end_src
